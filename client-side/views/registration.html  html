<div class="registration-page" ng-controller="RegistrationController as vm">
    <div class="container">
        <!-- 加载状态 -->
        <div ng-if="vm.isLoading" class="text-center">
            <div class="spinner"></div>
            <p>加载注册信息中...</p>
        </div>

        <!-- 注册表单 -->
        <div ng-if="!vm.isLoading && vm.event" class="registration-container">
            <div class="breadcrumb">
                <a href="/events">活动列表</a>
                <i class="fas fa-chevron-right"></i>
                <a ng-href="/events/{{vm.event.id}}">{{vm.event.title}}</a>
                <i class="fas fa-chevron-right"></i>
                <span>活动注册</span>
            </div>

            <div class="row">
                <!-- 注册表单 -->
                <div class="col-lg-8">
                    <div class="card">
                        <div class="card-header">
                            <h1>活动注册</h1>
                            <p>请填写以下信息完成注册</p>
                        </div>
                        
                        <div class="card-body">
                            <!-- 验证错误 -->
                            <div ng-if="vm.validationErrors.length > 0" class="alert alert-error">
                                <h4>请修正以下错误：</h4>
                                <ul>
                                    <li ng-repeat="error in vm.validationErrors">{{error}}</li>
                                </ul>
                            </div>

                            <form name="registrationForm" ng-submit="vm.submitRegistration()" novalidate>
                                <!-- 个人信息 -->
                                <div class="form-section">
                                    <h3>个人信息</h3>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="fullName" class="form-label">姓名 *</label>
                                                <input type="text" 
                                                       id="fullName"
                                                       class="form-control" 
                                                       ng-class="{'error': vm.validationErrors.includes('请输入姓名')}"
                                                       ng-model="vm.registrationData.full_name"
                                                       placeholder="请输入您的姓名"
                                                       required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="email" class="form-label">邮箱地址 *</label>
                                                <input type="email" 
                                                       id="email"
                                                       class="form-control" 
                                                       ng-class="{'error': vm.validationErrors.includes('请输入邮箱地址') || vm.validationErrors.includes('请输入有效的邮箱地址')}"
                                                       ng-model="vm.registrationData.email"
                                                       placeholder="请输入您的邮箱地址"
                                                       required>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="phone" class="form-label">联系电话</label>
                                        <input type="tel" 
                                               id="phone"
                                               class="form-control" 
                                               ng-model="vm.registrationData.phone"
                                               placeholder="请输入您的联系电话（可选）">
                                    </div>
                                </div>

                                <!-- 票务信息 -->
                                <div class="form-section">
                                    <h3>票务信息</h3>
                                    
                                    <div class="form-group">
                                        <label class="form-label">票数 *</label>
                                        <div class="ticket-selector">
                                            <button type="button" 
                                                    class="btn btn-outline" 
                                                    ng-click="vm.decreaseTickets()"
                                                    ng-disabled="vm.registrationData.ticket_count <= 1">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            
                                            <span class="ticket-count">{{vm.registrationData.ticket_count}}</span>
                                            
                                            <button type="button" 
                                                    class="btn btn-outline" 
                                                    ng-click="vm.increaseTickets()"
                                                    ng-disabled="vm.registrationData.ticket_count >= 10 || vm.registrationData.ticket_count >= vm.getAvailableTickets()">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                        <div class="form-help">
                                            每人最多可购买 10 张票，当前剩余 {{vm.getAvailableTickets()}} 张
                                        </div>
                                    </div>
                                </div>

                                <!-- 特殊需求 -->
                                <div class="form-section">
                                    <h3>特殊需求（可选）</h3>
                                    
                                    <div class="form-group">
                                        <label for="specialRequirements" class="form-label">特殊需求说明</label>
                                        <textarea id="specialRequirements"
                                                  class="form-control" 
                                                  ng-model="vm.registrationData.special_requirements"
                                                  placeholder="例如：饮食要求、无障碍需求、其他特殊需求等"
                                                  rows="4"></textarea>
                                        <div class="form-help">
                                            请在此说明任何特殊需求，我们会尽力满足
                                        </div>
                                    </div>
                                </div>

                                <!-- 提交按钮 -->
                                <div class="form-actions">
                                    <button type="submit" 
                                            class="btn btn-primary btn-lg"
                                            ng-disabled="vm.isSubmitting">
                                        <span ng-if="!vm.isSubmitting">
                                            <i class="fas fa-check"></i>
                                            确认注册
                                        </span>
                                        <span ng-if="vm.isSubmitting">
                                            <div class="spinner-sm"></div>
                                            提交中...
                                        </span>
                                    </button>
                                    
                                    <a ng-href="/events/{{vm.event.id}}" class="btn btn-outline btn-lg">
                                        取消
                                    </a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- 订单摘要 -->
                <div class="col-lg-4">
                    <div class="card order-summary">
                        <div class="card-header">
                            <h3>订单摘要</h3>
                        </div>
                        
                        <div class="card-body">
                            <!-- 活动信息 -->
                            <div class="event-summary">
                                <h4>{{vm.event.title}}</h4>
                                <div class="event-details">
                                    <p><i class="fas fa-calendar"></i> {{$root.formatDate(vm.event.event_date)}}</p>
                                    <p><i class="fas fa-map-marker-alt"></i> {{vm.event.location}}</p>
                                </div>
                            </div>
                            
                            <!-- 费用明细 -->
                            <div class="cost-breakdown">
                                <div class="cost-item">
                                    <span>票数</span>
                                    <span>{{vm.registrationData.ticket_count}} 张</span>
                                </div>
                                
                                <div class="cost-item" ng-if="vm.event.ticket_price > 0">
                                    <span>单价</span>
                                    <span>{{$root.formatCurrency(vm.event.ticket_price)}}</span>
                                </div>
                                
                                <div class="cost-divider"></div>
                                
                                <div class="cost-total">
                                    <strong>总计</strong>
                                    <strong>{{$root.formatCurrency(vm.calculateTotalAmount())}}</strong>
                                </div>
                                
                                <div class="cost-note" ng-if="vm.event.ticket_price === 0">
                                    此活动免费参与
                                </div>
                            </div>
                            
                            <!-- 重要提示 -->
                            <div class="important-notes">
                                <h5>重要提示</h5>
                                <ul>
                                    <li>注册成功后，您将收到确认邮件</li>
                                    <li>请确保填写的邮箱地址正确</li>
                                    <li>如需取消注册，请至少提前24小时联系组织方</li>
                                    <li>同一邮箱只能为同一活动注册一次</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 错误状态 -->
        <div ng-if="!vm.isLoading && !vm.event" class="text-center error-state">
            <i class="fas fa-exclamation-triangle"></i>
            <h2>无法注册</h2>
            <p>抱歉，找不到您要注册的活动或该活动无法注册。</p>
            <a href="/events" class="btn btn-primary">返回活动列表</a>
        </div>
    </div>
</div>