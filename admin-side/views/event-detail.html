<div class="event-detail-page" ng-controller="EventDetailController as vm">
    <!-- Page title -->
    <div class="page-header">
        <div class="header-left">
            <h1><i class="fas fa-calendar-alt"></i> Event Details</h1>
            <p>View event details and registration records</p>
        </div>
        <div class="header-right">
            <button class="btn btn-outline" ng-click="vm.goBack()">
                <i class="fas fa-arrow-left"></i> Back
            </button>
            <button class="btn btn-warning" ng-click="vm.editEvent()" ng-if="vm.event">
                <i class="fas fa-edit"></i> Edit
            </button>
        </div>
    </div>

    <!-- Loading state -->
    <div ng-if="vm.isLoading" class="loading-state">
        <div class="spinner"></div>
        <p>Loading event details...</p>
    </div>

    <!-- Event details content -->
    <div ng-if="!vm.isLoading && vm.event" class="content-section">
        <!-- Event basic information -->
        <div class="card">
            <div class="card-header">
                <h2>{{vm.event.title}}</h2>
                <div class="event-status">
                    <span class="status-badge" ng-class="{
                        'badge-success': vm.event.is_active && !vm.event.is_suspended,
                        'badge-warning': vm.event.is_active && vm.event.is_suspended,
                        'badge-secondary': !vm.event.is_active
                    }">
                        {{vm.event.is_active && !vm.event.is_suspended ? 'Active' : 
                          (vm.event.is_suspended ? 'Suspended' : 'Ended')}}
                    </span>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <div class="event-description">
                            <h4>Event Description</h4>
                            <p>{{vm.event.description}}</p>
                            <div ng-if="vm.event.full_description">
                                <h5>Detailed Description</h5>
                                <p>{{vm.event.full_description}}</p>
                            </div>
                        </div>
                        
                        <div class="event-details">
                            <h4>Event Details</h4>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <i class="fas fa-calendar"></i>
                                    <span class="label">Event Time:</span>
                                    <span>{{vm.formatDate(vm.event.event_date)}}</span>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span class="label">Event Location:</span>
                                    <span>{{vm.event.location}}</span>
                                </div>
                                <div class="detail-item" ng-if="vm.event.venue_details">
                                    <i class="fas fa-building"></i>
                                    <span class="label">Venue Details:</span>
                                    <span>{{vm.event.venue_details}}</span>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-users"></i>
                                    <span class="label">Maximum Attendees:</span>
                                    <span>{{vm.event.max_attendees}}</span>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-ticket-alt"></i>
                                    <span class="label">Ticket Price:</span>
                                    <span>{{vm.formatCurrency(vm.event.ticket_price)}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="event-stats">
                            <h4>Fundraising Statistics</h4>
                            <div class="progress-container">
                                <div class="progress-bar">
                                    <div class="progress-fill" 
                                         ng-style="{'width': vm.calculateProgress(vm.event.current_amount, vm.event.goal_amount) + '%'}">
                                    </div>
                                </div>
                                <div class="progress-text">
                                    <span>Raised {{vm.formatCurrency(vm.event.current_amount)}}</span>
                                    <span>Goal {{vm.formatCurrency(vm.event.goal_amount)}}</span>
                                </div>
                            </div>
                            
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-number">{{vm.getRegistrationStats().totalRegistrations}}</div>
                                    <div class="stat-label">Registrations</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">{{vm.getRegistrationStats().totalTickets}}</div>
                                    <div class="stat-label">Total Tickets</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab navigation -->
        <div class="tab-navigation">
            <button class="tab-btn" 
                    ng-class="{'active': vm.activeTab === 'details'}"
                    ng-click="vm.setActiveTab('details')">
                <i class="fas fa-info-circle"></i> Event Details
            </button>
            <button class="tab-btn" 
                    ng-class="{'active': vm.activeTab === 'registrations'}"
                    ng-click="vm.setActiveTab('registrations')">
                <i class="fas fa-users"></i> Registration Records ({{vm.registrations.length}})
            </button>
        </div>

        <!-- Tab content -->
        <div class="tab-content">
            <!-- Event details tab -->
            <div ng-if="vm.activeTab === 'details'" class="tab-pane">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h4>Organization Information</h4>
                                <div class="organization-info">
                                    <p><strong>Organization Name:</strong>{{vm.event.organization_name}}</p>
                                    <p><strong>Contact:</strong>{{vm.event.organization_contact}}</p>
                                    <p><strong>Phone:</strong>{{vm.event.organization_phone}}</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h4>Event Classification</h4>
                                <div class="category-info">
                                    <p><strong>Category:</strong>{{vm.event.category_name}}</p>
                                    <p><strong>Created At:</strong>{{vm.formatDate(vm.event.created_at)}}</p>
                                    <p><strong>Updated At:</strong>{{vm.formatDate(vm.event.updated_at)}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Registration records tab -->
            <div ng-if="vm.activeTab === 'registrations'" class="tab-pane">
                <div class="card">
                    <div class="card-header">
                        <h3>Registration Records</h3>
                        <div class="registration-stats">
                            <span>Total Registrations: {{vm.getRegistrationStats().totalRegistrations}}</span>
                            <span>Total Tickets: {{vm.getRegistrationStats().totalTickets}}</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div ng-if="vm.registrations.length === 0" class="empty-state">
                            <i class="fas fa-users"></i>
                            <h3>No Registration Records</h3>
                            <p>No users have registered for this event yet</p>
                        </div>
                        
                        <div ng-if="vm.registrations.length > 0" class="registrations-list">
                            <div class="registration-item" ng-repeat="registration in vm.registrations">
                                <div class="user-info">
                                    <div class="user-avatar">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="user-details">
                                        <h4>{{registration.full_name}}</h4>
                                        <p>{{registration.email}}</p>
                                        <p ng-if="registration.phone">{{registration.phone}}</p>
                                    </div>
                                </div>
                                <div class="registration-info">
                                    <div class="ticket-count">
                                        <i class="fas fa-ticket-alt"></i>
                                        {{registration.ticket_count}} tickets
                                    </div>
                                    <div class="registration-date">
                                        {{vm.formatDate(registration.registration_date)}}
                                    </div>
                                    <div class="special-requirements" ng-if="registration.special_requirements">
                                        <i class="fas fa-info-circle"></i>
                                        {{registration.special_requirements}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Error state -->
    <div ng-if="!vm.isLoading && !vm.event" class="error-state">
        <i class="fas fa-exclamation-triangle"></i>
        <h3>Loading Failed</h3>
        <p>{{vm.error || 'Unable to load event details, please try again later'}}</p>
        <button class="btn btn-primary" ng-click="vm.init()">Retry</button>
    </div>
</div>
